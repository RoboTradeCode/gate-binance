# binance_connector_cpp

## Ядро

Цель ядра — держать все деньги в BID и/или ASK лимит-ордерах, в некотором отдалении от [спреда](https://ru.wikipedia.org/wiki/Спред_(финансы)).

### Принцип работы

При первом включении ядро посылает команды на отмену возможных ордеров и ожидает информацию о балансе.

После получения информации о балансе алгоритм выставляет лимит-ордера на все доступные средства. Цена лимит-ордера
на покупку ставится выше текущего лучшего предложения, цена на продажу соответственно ниже.

Например, для ASK лимит-ордера:

![Торговый алгоритм](https://user-images.githubusercontent.com/44947427/147572369-a840c854-92b6-499a-b126-2cf2d93c100e.png)

Если лучшее предложение остаётся в промежутке между `min_ask` и `max_ask`, то алгоритм ничего не делает. Но как только
предложение пересекает одну из границ, ордер отменяется, значения пересчитываются, и ордер создаётся заново.

### Сборка

Перед сборкой самого кода нужно собрать зависимости:

- [Aeron](https://github.com/real-logic/aeron)
- [Easylogging++](https://github.com/amrayn/easyloggingpp)
- [JsonCpp](https://github.com/open-source-parsers/jsoncpp)

Также Вам точно потребуется изменить путь, ведущий до заголовочных файлов Aeron и Easylogging++. За это отвечают
следующие строки в `CMakeLists.txt`:

```
include_directories(/home/ubuntu/aeron/aeron-client/src/main/cpp)
easyloggingpp/src/easylogging++.cc easyloggingpp/src/easylogging++.h
```

JsonCpp и библиотека Aeron будут искаться в системе. JsonCpp затрагивает это в своём руководстве по сборке, но для Aeron
Вы должны сами установить библиотеку `libaeron_client.a`. Например, скопировав её в `/usr/lib/`.

После сборки зависимостей Вы можете собрать само ядро:

```
mkdir build
cd build
cmake ../
make
```

Собранный код представляет собой исполняемый файл `Core`. Вы можете просто запустить его:

```
./Core
```


### Логирование

Алгоритм записывает все операций по выставлению и отмене ордеров в файл `core.csv` (полный путь указывается в
конфигурации). Одна команда — одна строка. Значения разделяются символом табуляции:

```
log_ts receive_ts best_bid min_bid max_bid best_ask min_ask max_ask btc_balance usdt_balance action side price quantity
```

В файл `errors.log` записываются ошибки, которые приходят от шлюза:

```
log_ts error_text
```

#### Отладочное логирование

В целях отладки были добавлены 2 дополнительных уровня логирования. На первом уровне будут выводиться поступающие
обновления баланса и JSON представление отправляемых команд. На втором уровне добавляется вывод поступающих
ордербуков. Чтобы запустить ядро с дополнительным логированием передайте в параметре `--v` нужный вам уровень, например:

```
./Core --v=1
```

## Тестовый сервер

В целях тестирования ядро было запущено на сервере `18.159.92.185`. Исходный код и логи находятся в директории
`/home/ubuntu/binance_connector_cpp_core/`.

Код был запущен в качестве сервиса systemd со следующей конфигурацией:

```
[Unit]
Description=Binance Connector Core
After=network.target

[Service]
User=ubuntu
ExecStart=/home/ubuntu/binance_connector_cpp_core/build/Core
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

> Аналогично ядру на сервере был запущен и шлюз
